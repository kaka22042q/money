<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>å¤¢æƒ³è¨˜å¸³æœ¬</title><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--cat-main:#FFB7B2;--cat-bg:#fffaf0;--cat-dark:#5D4037;--cat-gray:#D7CCC8;--cat-red:#ff7675;--cat-green:#55efc4;--cat-blue:#74b9ff;--cat-light-pink:#FFD9D6;--cat-orange:#fab1a0}
*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;font-family:-apple-system,"Noto Sans TC",sans-serif}
body{background:var(--cat-bg);color:var(--cat-dark);margin:0;padding-bottom:160px;font-size:14px}
.container{max-width:450px;margin:0 auto;padding:12px}.page{display:none}.page.active{display:block;animation:fadeIn 0.3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.cat-card{background:#fff;border:2.5px solid var(--cat-dark);box-shadow:4px 4px 0 var(--cat-gray);border-radius:18px;margin-bottom:15px;padding:15px;position:relative}
input,select,textarea{width:100%;border:2px solid var(--cat-gray);border-radius:10px;padding:10px;margin-top:5px;font-size:16px;outline:none;background:#fff;color:var(--cat-dark)}
textarea{background:#fafafa;line-height:1.5;resize:none;height:110px}
label{font-size:13px;font-weight:bold;display:block;margin-top:12px;color:var(--cat-dark);border-left:4px solid var(--cat-main);padding-left:8px}
.hint{font-size:11px;color:#888;margin-top:3px;font-weight:normal}
#amt{font-size:26px;height:50px;text-align:center;color:var(--cat-red);border:2.5px solid var(--cat-dark);margin-bottom:8px;font-weight:bold}
.kb-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:5px}
.kb-btn{height:42px;border:1.5px solid var(--cat-dark);border-radius:10px;background:#fff;font-weight:900;color:var(--cat-dark);cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center}
.kb-btn:active{transform:scale(.92);background:var(--cat-light-pink)}.op-btn{background:var(--cat-bg)}.eq-btn{background:var(--cat-main);color:#fff}.ac-btn{background:#f0f0f0;color:#999}
.btn-main{background:var(--cat-main);border:2.5px solid var(--cat-dark);box-shadow:0 4px 0 var(--cat-dark);font-weight:700;color:#fff;border-radius:15px;padding:15px;width:100%;cursor:pointer;margin-top:15px;font-size:17px;letter-spacing:2px}
.nav-bar{position:fixed;bottom:20px;left:15px;right:15px;background:#fff;border:3px solid var(--cat-dark);box-shadow:0 6px 0 var(--cat-gray);display:flex;justify-content:space-around;padding:10px 5px;z-index:100;border-radius:30px;height:85px;align-items:center}
.nav-item{border:none;background:none;text-align:center;flex:1;cursor:pointer;opacity:.35}.nav-item.active{opacity:1}.nav-icon{font-size:30px;display:block;margin-bottom:2px}.nav-text{font-size:11px;font-weight:700;color:var(--cat-dark)}
.prog-container{background:#EFEBE9;height:16px;border-radius:8px;border:1.5px solid var(--cat-dark);overflow:hidden;margin:5px 0}.prog-fill{height:100%;transition:width .6s;background:var(--cat-blue)}
.calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;text-align:center}.cal-day{padding:10px 0;border-radius:8px;font-size:12px;cursor:pointer;position:relative;min-height:45px}
.cal-day.today{background:var(--cat-light-pink);font-weight:700;border:1.5px solid var(--cat-main)}.cal-day.has-record::after{content:'â€¢';position:absolute;bottom:2px;left:50%;transform:translateX(-50%);color:var(--cat-red);font-size:20px;line-height:0}
.record-item{display:flex;justify-content:space-between;border-bottom:1px solid #eee;padding:12px 0;align-items:center}.item-btns{display:flex;gap:8px}.edit-btn{background:var(--cat-blue);color:#fff;border:1.5px solid var(--cat-dark);border-radius:6px;font-size:11px;padding:5px 10px;cursor:pointer}.del-btn{background:var(--cat-red);color:#fff;border:1.5px solid var(--cat-dark);border-radius:6px;font-size:11px;padding:5px 10px;cursor:pointer}
.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.7);align-items:center;justify-content:center;backdrop-filter:blur(4px)}.modal-content{background:#fff;width:88%;max-height:85vh;overflow-y:auto;padding:25px;border-radius:25px;border:3px solid var(--cat-dark);text-align:center}
</style>
</head>
<body>
<div id="manual-modal" class="modal"><div class="modal-content"><h3>ğŸ¾ èªªæ˜æ›¸</h3><div id="manual-display" style="white-space:pre-wrap;text-align:left"></div><button onclick="document.getElementById('manual-modal').style.display='none'" class="btn-main">é—œé–‰</button></div></div>
<div id="sub-modal" class="modal"><div class="modal-content"><h3>â° å®šæœŸæ‰£æ¬¾</h3><p id="sub-modal-desc"></p><button onclick="processSub(true)" class="btn-main">ç¢ºèª</button><button onclick="processSub(false)" style="background:none;border:none;color:#aaa;margin-top:10px">è·³é</button></div></div>
<div class="container">
<div id="page-daily" class="page active">
<h2 id="daily-title" style="text-align:center">âœï¸ å¿«é€Ÿè¨˜å¸³</h2>
<div class="cat-card"><input type="hidden" id="edit-id"><input type="text" id="amt" value="0" readonly><div id="kb-container" class="kb-grid"></div><label>é¡å‹</label><select id="trans-mode" onchange="toggleFields()"><option value="exp">ğŸ’¸ æ”¯å‡º</option><option value="inc">ğŸ’° æ”¶å…¥</option><option value="save">ğŸ’ å­˜éŒ¢ç­’</option><option value="transfer">ğŸ”„ è½‰å¸³</option></select><div id="acc-source-area"><label>æ”¯ä»˜å¸³æˆ¶</label><select id="acc-source"></select></div><div id="transfer-area" style="display:none"><label>è½‰å…¥å¸³æˆ¶</label><select id="acc-to"></select></div><div id="jar-area" style="display:none"><label>è¨ˆç•«ç›®æ¨™</label><select id="jar-target"></select></div><label>åˆ†é¡</label><div style="display:flex;gap:5px"><select id="mainCat" onchange="renderSubCats()"></select><select id="subCat"></select></div><label>å‚™è¨»</label><textarea id="note"></textarea><label>æ—¥æœŸ</label><input type="date" id="record-date"><button onclick="saveAll()" id="save-btn" class="btn-main">ç¢ºèªå­˜æª”</button><button onclick="location.reload()" id="cancel-edit" style="display:none;margin-top:10px;width:100%;border:none;padding:12px;border-radius:15px;background:#eee">å–æ¶ˆä¿®æ”¹</button></div>
</div>
<div id="page-home" class="page">
<h2 style="text-align:center">ğŸ¾ å¤¢æƒ³é¦–é </h2><div id="jarList"></div>
<div class="cat-card"><h3>ğŸ“… é ç®—é€²åº¦</h3><div id="home-budget-list"></div></div>
<div class="cat-card"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><button onclick="changeMonth(-1)">â®</button><h3 id="cal-month-title"></h3><button onclick="changeMonth(1)">â¯</button></div><div class="calendar-grid" id="calendar-grid"></div><div id="day-detail-area" style="display:none;margin-top:15px;border-top:1px dashed var(--cat-gray);padding-top:10px"><div id="day-records"></div></div></div>
</div>
<div id="page-assets" class="page">
<h2>ğŸ¦ è²¡å‹™åˆ†æ</h2><div class="cat-card"><div id="asset-list"></div></div><div class="cat-card" style="height:200px"><canvas id="pieChart"></canvas></div><div class="cat-card"><input type="text" id="global-search" placeholder="ğŸ” æœå°‹..." oninput="renderAssetsAndHistory()"><div id="full-history-list" style="margin-top:10px"></div></div>
</div>
<div id="page-settings" class="page">
<h2>âš™ï¸ è¨­å®š</h2><div class="cat-card"><button onclick="openManual()" class="btn-main" style="background:var(--cat-blue);margin-top:0">ğŸ“˜ èªªæ˜æ›¸</button><label>ç™¼è–ªæ—¥</label><input type="number" id="budget-day-input"><label>æœˆé ç®— (é¡åˆ¥:é‡‘é¡)</label><textarea id="budget-editor"></textarea><label>åˆ†é¡ (å¤§é¡:å°1,å°2)</label><textarea id="cat-editor"></textarea><label>å¸³æˆ¶ (åç¨±:é‡‘é¡)</label><textarea id="acc-editor"></textarea><label>å®šæœŸ (å:é¡,å¤§,å°,å¸³,æ—¥)</label><textarea id="sub-editor"></textarea><label>å­˜éŒ¢ç­’ (å:é¡,æœˆèµ·,æœˆæ­¢)</label><textarea id="jar-editor"></textarea><button onclick="saveSettings()" class="btn-main" style="background:var(--cat-green)">å„²å­˜è®Šæ›´</button></div>
</div>
</div>
<nav class="nav-bar">
<button class="nav-item active" onclick="showPage('daily',this)"><div class="nav-icon">âœï¸</div><div class="nav-text">è¨˜å¸³</div></button>
<button class="nav-item" onclick="showPage('home',this)"><div class="nav-icon">ğŸ“…</div><div class="nav-text">é¦–é </div></button>
<button class="nav-item" onclick="showPage('assets',this)"><div class="nav-icon">ğŸ¦</div><div class="nav-text">åˆ†æ</div></button>
<button class="nav-item" onclick="showPage('settings',this)"><div class="nav-icon">âš™ï¸</div><div class="nav-text">è¨­å®š</div></button>
</nav>
<script>
const DB_KEY='cat_db_v60';let store=JSON.parse(localStorage.getItem(DB_KEY))||{budgetDay:10,accs:{'ç¾é‡‘':0},cats:{'é£²é£Ÿ':['å¤–é£Ÿ']},incCats:{'å·¥ä½œ':['æœˆè–ª']},budgets:{'é£²é£Ÿ':5000},history:[],subs:{},subLog:[],jarBalances:{},jars:{}};
let pieChart=null,calcBuffer="",viewDate=new Date();
window.onload=()=>{const n=new Date();document.getElementById('record-date').value=n.toISOString().split('T')[0];initDaily();renderKeyboard()};
function saveToDB(){localStorage.setItem(DB_KEY,JSON.stringify(store))}
function showPage(p,el){document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));document.getElementById('page-'+p).classList.add('active');document.querySelectorAll('.nav-item').forEach(x=>x.classList.remove('active'));el.classList.add('active');if(p==='home')renderHome();if(p==='assets')renderAssetsAndHistory();if(p==='settings')initSettings()}
function initSettings(){document.getElementById('budget-day-input').value=store.budgetDay;document.getElementById('cat-editor').value=Object.entries(store.cats).map(([k,v])=>`${k}:${v.join(',')}`).join('\n');document.getElementById('acc-editor').value=Object.entries(store.accs).map(([k,v])=>`${k}:${v}`).join('\n');document.getElementById('budget-editor').value=Object.entries(store.budgets).map(([k,v])=>`${k}:${v}`).join('\n');document.getElementById('sub-editor').value=Object.entries(store.subs||{}).map(([k,v])=>`${k}:${v.amt},${v.main},${v.sub},${v.acc},${v.day}`).join('\n');document.getElementById('jar-editor').value=Object.entries(store.jars||{}).map(([k,v])=>`${k}:${v.goal},${v.start},${v.end}`).join('\n')}
function saveSettings(){try{store.budgetDay=Number(document.getElementById('budget-day-input').value);const p=(id,isC)=>{const o={};document.getElementById(id).value.trim().split('\n').forEach(l=>{const[k,v]=l.split(':');if(k&&v)o[k.trim()]=isC?v.split(',').map(s=>s.trim()):Number(v)});return o};store.cats=p('cat-editor',1);store.accs=p('acc-editor');store.budgets=p('budget-editor');const s={};document.getElementById('sub-editor').value.split('\n').forEach(l=>{const[k,v]=l.split(':');if(k&&v){const x=v.split(',');s[k.trim()]={amt:Number(x[0]),main:x[1].trim(),sub:x[2].trim(),acc:x[3].trim(),day:Number(x[4])}}});store.subs=s;const j={};document.getElementById('jar-editor').value.split('\n').forEach(l=>{const[k,v]=l.split(':');if(k&&v){const x=v.split(',');j[k.trim()]={goal:Number(x[0]),start:x[1],end:x[2]}}});store.jars=j;saveToDB();alert('å®Œæˆï¼');location.reload()}catch(e){alert('æ ¼å¼éŒ¯èª¤')}}
function renderHome(){const jl=document.getElementById('jarList');jl.innerHTML="";for(let n in store.jars){const j=store.jars[n],b=store.jarBalances[n]||0,p=Math.min(Math.round(b/j.goal*100),100);jl.innerHTML+=`<div class="cat-card"><b>ğŸ’ ${n}</b> <small>$${b}/$${j.goal}</small><div class="prog-container"><div class="prog-fill" style="width:${p}%"></div></div></div>`}renderCalendar()}
function renderCalendar(){const g=document.getElementById('calendar-grid');g.innerHTML="";const y=viewDate.getFullYear(),m=viewDate.getMonth();document.getElementById('cal-month-title').innerText=`${y}/${m+1}`;const f=new Date(y,m,1).getDay(),l=new Date(y,m+1,0).getDate();for(let i=0;i<f;i++)g.innerHTML+='<div></div>';for(let d=1;d<=l;d++){const ds=`${y}-${(m+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;g.innerHTML+=`<div class="cal-day ${store.history.some(h=>h.date===ds)?'has-record':''}" onclick="selectDate('${ds}')">${d}</div>`}}
function selectDate(ds){document.getElementById('day-detail-area').style.display='block';const rs=store.history.filter(h=>h.date===ds);document.getElementById('day-records').innerHTML=rs.map(r=>`<div class="record-item"><span>${r.note||r.sub} ($${r.amt})</span><div class="item-btns"><button class="edit-btn" onclick="editR(${r.id})">ä¿®</button><button class="del-btn" onclick="delR(${r.id})">ğŸ—‘ï¸</button></div></div>`).join('')||'ç„¡ç´€éŒ„'}
function editR(id){const h=store.history.find(x=>x.id===id);document.getElementById('edit-id').value=id;document.getElementById('amt').value=h.amt;document.getElementById('note').value=h.note;document.getElementById('cancel-edit').style.display='block';showPage('daily',document.querySelectorAll('.nav-item')[0])}
function delR(id){if(!confirm('åˆªé™¤ï¼Ÿ'))return;const h=store.history.find(x=>x.id===id);if(h.type==='exp')store.accs[h.src]+=h.amt;if(h.type==='inc')store.accs[h.src]-=h.amt;store.history=store.history.filter(x=>x.id!==id);saveToDB();location.reload()}
function saveAll(){const eid=document.getElementById('edit-id').value;if(eid)store.history=store.history.filter(x=>x.id!=eid);const m=document.getElementById('trans-mode').value,a=Number(document.getElementById('amt').value),d=document.getElementById('record-date').value,src=document.getElementById('acc-source').value.split(':')[1];if(m==='exp')store.accs[src]-=a;else if(m==='inc')store.accs[src]+=a;else if(m==='save'){store.accs[src]-=a;const j=document.getElementById('jar-target').value;store.jarBalances[j]=(store.jarBalances[j]||0)+a}store.history.push({id:Date.now(),date:d,amt:a,type:m,main:document.getElementById('mainCat').value,sub:document.getElementById('subCat').value,src,note:document.getElementById('note').value});saveToDB();location.reload()}
function renderKeyboard(){const k=['7','8','9','/','4','5','6','*','1','2','3','-','0','AC','=','+'];const c=document.getElementById('kb-container');c.innerHTML=k.map(x=>`<button class="kb-btn" onclick="press('${x}')">${x}</button>`).join('')}
function press(v){const e=document.getElementById('amt');if(v==='AC'){e.value='0';calcBuffer=''}else if(v==='='){e.value=eval(calcBuffer);calcBuffer=e.value}else{calcBuffer+=v;e.value=calcBuffer}}
function initDaily(){document.getElementById('acc-source').innerHTML=Object.keys(store.accs).map(k=>`<option value="ACC:${k}">${k}</option>`).join('');document.getElementById('jar-target').innerHTML=Object.keys(store.jars).map(k=>`<option value="${k}">${k}</option>`).join('');document.getElementById('mainCat').innerHTML=Object.keys(store.cats).map(k=>`<option value="${k}">${k}</option>`).join('');renderSubCats()}
function renderSubCats(){const m=document.getElementById('mainCat').value;document.getElementById('subCat').innerHTML=store.cats[m].map(s=>`<option value="${s}">${s}</option>`).join('')}
function toggleFields(){const m=document.getElementById('trans-mode').value;document.getElementById('transfer-area').style.display=m==='transfer'?'block':'none';document.getElementById('jar-area').style.display=m==='save'?'block':'none'}
function changeMonth(v){viewDate.setMonth(viewDate.getMonth()+v);renderCalendar()}
</script>
</body>
</html>
