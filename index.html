<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å°æ—¥å­è¨˜å¸³æœ¬ âœ¨</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-pink: #ffafbd;
            --soft-yellow: #ffedbc;
            --soft-blue: #a1c4fd;
            --soft-green: #c2e9fb;
            --text-color: #5a5a5a;
            --accent: #ff8e8e;
        }

        body {
            font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
            background: linear-gradient(135deg, var(--primary-pink) 0%, var(--soft-yellow) 100%);
            margin: 0; padding-bottom: 80px; color: var(--text-color);
            min-height: 100vh;
        }

        /* é ‚éƒ¨æ¨™é¡Œ */
        .app-header { text-align: center; padding: 20px 0; font-size: 1.5rem; font-weight: bold; color: #fff; text-shadow: 1px 1px 3px rgba(0,0,0,0.1); }

        /* å¡ç‰‡è¨­è¨ˆ */
        .container { padding: 15px; }
        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.05);
            border: 2px solid #fff;
        }

        h2 { font-size: 1.1rem; margin-top: 0; display: flex; align-items: center; gap: 8px; color: var(--accent); }

        /* è¨ˆç®—æ©ŸæŒ‰éˆ• */
        .calc-grid, .coin-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .calc-btn, .coin-btn {
            background: #fff; border: none; padding: 15px 5px; border-radius: 15px;
            font-size: 1.1rem; cursor: pointer; transition: 0.2s;
            box-shadow: 0 4px 0 #eee; color: var(--text-color);
        }
        .calc-btn:active { transform: translateY(3px); box-shadow: none; }
        .calc-btn.action { background: var(--primary-pink); color: white; box-shadow: 0 4px 0 #e6a1ad; }

        /* å°è¦½åˆ— */
        .nav-bar {
            position: fixed; bottom: 15px; left: 15px; right: 15px;
            background: white; display: flex; border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15); z-index: 1000;
        }
        .nav-item { flex: 1; text-align: center; padding: 12px 0; font-size: 11px; cursor: pointer; filter: grayscale(1); opacity: 0.6; transition: 0.3s; }
        .nav-item.active { filter: grayscale(0); opacity: 1; transform: translateY(-5px); font-weight: bold; color: var(--accent); }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }

        /* å­˜éŒ¢ç­’é€²åº¦æ¢ */
        .piggy-card { background: #fffaf0; border-radius: 15px; padding: 15px; margin-bottom: 10px; border-left: 5px solid var(--accent); }
        .progress-outer { height: 15px; background: #eee; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-inner { height: 100%; background: linear-gradient(90deg, #ff9a9e, #fad0c4); border-radius: 10px; transition: 0.5s; }

        /* æœˆæ›†æ¨£å¼ */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; text-align: center; }
        .calendar-day { padding: 10px 0; border-radius: 10px; font-size: 0.8rem; cursor: pointer; position: relative; }
        .calendar-day.active-day { background: var(--primary-pink); color: white; }
        .dot { height: 4px; width: 4px; background: var(--accent); border-radius: 50%; position: absolute; bottom: 3px; left: 50%; transform: translateX(-50%); }

        /* è¡¨å–®èˆ‡è¼¸å…¥ */
        input, select { border: 2px solid #f0f0f0; border-radius: 12px; padding: 12px; margin: 5px 0; background: #fff; }
        input:focus { border-color: var(--primary-pink); outline: none; }

        .btn-main { background: var(--accent); color: white; border: none; padding: 15px; border-radius: 15px; width: 100%; font-size: 1rem; font-weight: bold; margin-top: 10px; cursor: pointer; }

        .page { display: none; padding: 10px; animation: slideUp 0.4s ease; }
        .page.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="app-header">âœ¨ å°æ—¥å­ç†è²¡ç®¡å®¶ âœ¨</div>

<div class="container">
    <div id="page-quick" class="page active">
        <div class="card">
            <h2>ğŸ“ å¿«é€Ÿè¨˜å¸³</h2>
            <input type="text" id="note" placeholder="æƒ³è¨˜éŒ„ä»€éº¼ï¼Ÿ(å¦‚ï¼šé¦™è‰æ‹¿éµ â˜•)">
            <select id="category">
                <option value="ğŸ• é£Ÿ">ğŸ• è‚šå­é¤“äº† (é£Ÿ)</option>
                <option value="ğŸ‘• è¡£">ğŸ‘• è²·æ¼‚äº®è¡£æœ (è¡£)</option>
                <option value="ğŸ  ä½">ğŸ  æº«é¦¨çš„å°çª© (ä½)</option>
                <option value="ğŸšŒ è¡Œ">ğŸšŒ å‡ºé–€èµ°èµ° (è¡Œ)</option>
                <option value="ğŸ® æ¨‚">ğŸ® çŠ’è³è‡ªå·± (æ¨‚)</option>
                <option value="ğŸ’° æ”¶å…¥">ğŸ’° éŒ¢éŒ¢é€²ä¾†äº† (æ”¶å…¥)</option>
            </select>
            <div id="display" style="font-size: 2.5rem; text-align: right; margin: 15px 0; color: var(--accent); font-weight: bold; padding: 10px; border-bottom: 2px dashed var(--primary-pink);">0</div>
            
            <div id="calc-ui">
                <div class="calc-grid">
                    <button class="calc-btn" onclick="tap('7')">7</button><button class="calc-btn" onclick="tap('8')">8</button><button class="calc-btn" onclick="tap('9')">9</button><button class="calc-btn action" onclick="tap('AC')">AC</button>
                    <button class="calc-btn" onclick="tap('4')">4</button><button class="calc-btn" onclick="tap('5')">5</button><button class="calc-btn" onclick="tap('6')">6</button><button class="calc-btn action" onclick="tap('+')">+</button>
                    <button class="calc-btn" onclick="tap('1')">1</button><button class="calc-btn" onclick="tap('2')">2</button><button class="calc-btn" onclick="tap('3')">3</button><button class="calc-btn action" onclick="saveRecord()">OK</button>
                    <button class="calc-btn" style="grid-column: span 4;" onclick="tap('0')">0</button>
                </div>
            </div>

            <div id="coin-ui" style="display:none;">
                <div class="coin-grid">
                    <button class="coin-btn" onclick="addMoney(1)">+1 ğŸª™</button>
                    <button class="coin-btn" onclick="addMoney(5)">+5 ğŸª™</button>
                    <button class="coin-btn" onclick="addMoney(10)">+10 ğŸª™</button>
                    <button class="coin-btn" onclick="addMoney(50)">+50 ğŸª™</button>
                    <button class="coin-btn" onclick="addMoney(100)">+100 ğŸ’µ</button>
                    <button class="coin-btn" onclick="addMoney(500)">+500 ğŸ’µ</button>
                    <button class="coin-btn" onclick="addMoney(1000)">+1k ğŸ’</button>
                    <button class="calc-btn action" onclick="saveRecord()">OK</button>
                </div>
            </div>
        </div>
    </div>

    <div id="page-home" class="page">
        <div class="card">
            <h2>ğŸ· å­˜éŒ¢å°è±¬é€²åº¦</h2>
            <div id="piggy-area"></div>
        </div>
        <div class="card">
            <div style="display:flex; justify-content: space-between; align-items: center;">
                <button onclick="changeMonth(-1)" style="border:none; background:none; font-size:20px;">ğŸ‘ˆ</button>
                <h3 id="cal-title">2026å¹´ 1æœˆ</h3>
                <button onclick="changeMonth(1)" style="border:none; background:none; font-size:20px;">ğŸ‘‰</button>
            </div>
            <div class="calendar-grid" id="cal-grid"></div>
            <div id="cal-detail" style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;"></div>
        </div>
    </div>

    <div id="page-ana" class="page">
        <div class="card" style="background: var(--accent); color: white;">
            <div style="font-size: 0.9rem; opacity: 0.9;">æˆ‘çš„ç¸½è²¡ç”¢ ğŸ’°</div>
            <div id="total-assets" style="font-size: 2rem; font-weight: bold;">$0</div>
        </div>
        <div class="card">
            <h2>ğŸŒˆ æ”¯å‡ºæ¯”ä¾‹åœ–</h2>
            <canvas id="pieChart"></canvas>
        </div>
        <div class="card">
            <h2>ğŸ” æ‰¾å¸³ç›®</h2>
            <input type="text" id="search" placeholder="è¼¸å…¥é—œéµå­—..." oninput="doSearch()">
            <div id="search-list"></div>
        </div>
    </div>

    <div id="page-set" class="page">
        <div class="card">
            <h2>ğŸ“… èµ·å§‹æ—¥è¨­å®š</h2>
            <p style="font-size: 0.8rem; color: #888;">ä¾‹å¦‚è¨­å®š 10 è™Ÿï¼Œæ¯æœˆçµ±è¨ˆå°‡å¾ 10 è™Ÿç®—åˆ°éš”æœˆ 9 è™Ÿã€‚</p>
            <input type="number" id="startDay" min="1" max="31" value="10" onchange="updateSet()">
        </div>
        <div class="card">
            <h2>ğŸ§¸ å­˜éŒ¢ç›®æ¨™è¨­å®š</h2>
            <input type="text" id="p-name" placeholder="ç›®æ¨™åç¨± (å¦‚ï¼šè²·é›»è…¦)">
            <input type="number" id="p-goal" placeholder="ç›®æ¨™é‡‘é¡">
            <input type="date" id="p-end">
            <button class="btn-main" onclick="savePiggy()">é–‹å§‹å­˜éŒ¢è¨ˆç•« ğŸš€</button>
        </div>
        <div class="card">
            <h2>ğŸ’¾ è³‡æ–™ç®¡ç†</h2>
            <button class="btn-main" style="background:var(--soft-blue);" onclick="exportJSON()">å‚™ä»½è³‡æ–™ (JSON)</button>
            <button class="btn-main" style="background:var(--soft-green); margin-top:5px;" onclick="exportCSV()">åŒ¯å‡º CSV (Excel)</button>
            <button class="btn-main" style="background:#ccc; margin-top:20px;" onclick="clearAll()">ğŸ’¥ åˆªé™¤æ•´æœ¬å¸³æœ¬</button>
        </div>
    </div>
</div>

<nav class="nav-bar">
    <div class="nav-item active" onclick="nav('quick')"><span class="nav-icon">âœï¸</span>è¨˜ä¸€ç­†</div>
    <div class="nav-item" onclick="nav('home')"><span class="nav-icon">ğŸ </span>é¦–é </div>
    <div class="nav-item" onclick="nav('ana')"><span class="nav-icon">ğŸ“Š</span>åˆ†æ</div>
    <div class="nav-item" onclick="nav('set')"><span class="nav-icon">âš™ï¸</span>åŠŸèƒ½</div>
</nav>

<script>
    let db = JSON.parse(localStorage.getItem('cute_money_db')) || {
        records: [], piggies: [], config: { startDay: 10, mode: 'calc' }
    };

    let curDisplay = "0";
    let curMonth = new Date();

    // å°è¦½åˆ‡æ›
    function nav(p) {
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        document.getElementById('page-'+p).classList.add('active');
        event.currentTarget.classList.add('active');
        if(p==='home') renderHome();
        if(p==='ana') renderAna();
    }

    // è¨ˆç®—æ©Ÿé‚è¼¯
    function tap(k) {
        const d = document.getElementById('display');
        if(k==='AC') curDisplay = "0";
        else if(k==='+') curDisplay += "+";
        else curDisplay = (curDisplay === "0") ? k : curDisplay + k;
        d.innerText = curDisplay;
    }

    function addMoney(v) {
        curDisplay = (parseInt(curDisplay) + v).toString();
        document.getElementById('display').innerText = curDisplay;
    }

    function saveRecord() {
        try {
            const amt = eval(curDisplay);
            const cat = document.getElementById('category').value;
            const note = document.getElementById('note').value || "æœªå‘½åç´€éŒ„";
            db.records.push({ id: Date.now(), date: new Date().toISOString().split('T')[0], amt, cat, note });
            save(); alert('è¨˜å¥½å›‰ï¼ğŸ¦„');
            curDisplay = "0"; document.getElementById('display').innerText = "0";
        } catch(e) { alert('é‡‘é¡ä¸å°å–” ğŸ§Š'); }
    }

    // å­˜éŒ¢ç­’é‚è¼¯
    function renderHome() {
        // å­˜éŒ¢ç­’
        const pArea = document.getElementById('piggy-area');
        pArea.innerHTML = '';
        db.piggies.forEach(p => {
            const today = new Date();
            const end = new Date(p.end);
            const monthsLeft = (end.getFullYear() - today.getFullYear()) * 12 + (end.getMonth() - today.getMonth());
            const totalIncome = db.records.filter(r => r.cat.includes('æ”¶å…¥')).reduce((a,b)=>a+b.amt,0);
            const progress = Math.min((totalIncome / p.goal * 100), 100).toFixed(1);
            
            pArea.innerHTML += `
                <div class="piggy-card">
                    <strong>ğŸˆ ${p.name}</strong> <span style="float:right">$${p.goal}</span>
                    <div class="progress-outer"><div class="progress-inner" style="width:${progress}%"></div></div>
                    <div style="font-size:0.75rem; color:#888;">å·²é”æ¨™ ${progress}% | å‰©é¤˜ ${monthsLeft} å€‹æœˆ</div>
                </div>
            `;
        });
        renderCalendar();
    }

    // æœˆæ›†
    function renderCalendar() {
        const grid = document.getElementById('cal-grid');
        const title = document.getElementById('cal-title');
        grid.innerHTML = '';
        const y = curMonth.getFullYear(), m = curMonth.getMonth();
        title.innerText = `${y}å¹´ ${m+1}æœˆ`;
        
        const first = new Date(y, m, 1).getDay();
        const last = new Date(y, m+1, 0).getDate();

        for(let i=0; i<first; i++) grid.innerHTML += '<div></div>';
        for(let d=1; d<=last; d++) {
            const dateStr = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
            const has = db.records.some(r => r.date === dateStr);
            const isToday = new Date().toISOString().split('T')[0] === dateStr;
            grid.innerHTML += `<div class="calendar-day ${isToday?'active-day':''}" onclick="showDetail('${dateStr}')">${d}${has?'<div class="dot"></div>':''}</div>`;
        }
    }

    function showDetail(d) {
        const area = document.getElementById('cal-detail');
        const items = db.records.filter(r => r.date === d);
        area.innerHTML = `<b>ğŸ“ ${d} ç´€éŒ„:</b><br>`;
        items.forEach(r => {
            area.innerHTML += `<div style="padding:5px 0; font-size:0.9rem;">${r.cat} ${r.note} <span style="color:var(--accent)">$${r.amt}</span> <button onclick="delRec(${r.id})" style="border:none; color:red; background:none;">ğŸ—‘ï¸</button></div>`;
        });
    }

    function delRec(id) {
        if(confirm('è¦åˆªæ‰é€™ç­†å—ï¼ŸğŸ¥º')) {
            db.records = db.records.filter(r => r.id !== id);
            save(); renderHome();
        }
    }

    // åˆ†æåœ–è¡¨
    let chartInstance;
    function renderAna() {
        const ctx = document.getElementById('pieChart').getContext('2d');
        const cats = {};
        db.records.filter(r => !r.cat.includes('æ”¶å…¥')).forEach(r => {
            cats[r.cat] = (cats[r.cat] || 0) + Math.abs(r.amt);
        });

        document.getElementById('total-assets').innerText = '$' + db.records.reduce((a,b)=>a+(r.cat.includes('æ”¶å…¥')?b.amt:-b.amt),0);

        if(chartInstance) chartInstance.destroy();
        chartInstance = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: Object.keys(cats),
                datasets: [{ data: Object.values(cats), backgroundColor: ['#ffafbd', '#ffedbc', '#a1c4fd', '#c2e9fb', '#fbc2eb'] }]
            },
            options: { cutout: '70%' }
        });
    }

    // å…¶ä»–åŠŸèƒ½
    function savePiggy() {
        const name = document.getElementById('p-name').value;
        const goal = document.getElementById('p-goal').value;
        const end = document.getElementById('p-end').value;
        if(!name || !goal) return alert('è³‡è¨Šè¦å¡«å®Œæ•´å–” ğŸŒ¸');
        db.piggies.push({ name, goal, end });
        save(); alert('å­˜éŒ¢è¨ˆç•«é–‹å§‹ï¼');
    }

    function save() { localStorage.setItem('cute_money_db', JSON.stringify(db)); }
    function changeMonth(v) { curMonth.setMonth(curMonth.getMonth() + v); renderCalendar(); }
    function exportCSV() {
        let csv = "æ—¥æœŸ,åˆ†é¡,é …ç›®,é‡‘é¡\n";
        db.records.forEach(r => csv += `${r.date},${r.cat},${r.note},${r.amt}\n`);
        const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "æˆ‘çš„è¨˜å¸³æœ¬.csv";
        link.click();
    }
    function clearAll() {
        if(confirm('ç¢ºå®šè¦å…¨éƒ¨æ¸…ç©ºå—ï¼ŸğŸ˜°')) {
            if(confirm('çœŸçš„çœŸçš„ç¢ºå®šå—ï¼Ÿè³‡æ–™æœƒä¸è¦‹å–”ï¼')) {
                db.records = []; db.piggies = []; save(); location.reload();
            }
        }
    }
</script>
</body>
</html>
